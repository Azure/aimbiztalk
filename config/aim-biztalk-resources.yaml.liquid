{%- for application in model.migration_target.message_bus.applications %}
  {%- for endpoint in application.endpoints -%}
    {%- if endpoint.endpoint_type == "Adapter" and endpoint.adapter_protocol == "FILE" %}      
      {%- deploy_data_gateway = true -%}
    {%- endif %}
  {%- endfor %}
{%- endfor %}
#
# A target model is produced by analyzing the source model and adding logical messaging
# objects that represent the source model artifacts.
#
# As part of the analysis stage, each logical messaging object is associated with a resource
# map key.  This key is used to look up the resources in this configuration file and
# associated template configuration files and the discovered resources are added to the target model.
#
# The configuration files themselves can also be rendered using the Liquid template language.
#

# A resource associates the templates that are used to represent and deploy the resource in Azure
# keyed by the AIS target environment.  The target environment is an enumeration defined in the model
# and determines what environment the templates support.
resources:

  # ------------------------------------------------------------------------------
  # AIS generic resources
  # ------------------------------------------------------------------------------

  - resource: deployment
    targets:
      - target: ['consumption']
        templates:
          - deployConsumptionResources
      - target: ['standard']
        templates:
          - deployStandardResources

  - resource: messageBusGroup
    targets:
      - target: ['consumption', 'standard']
        templates:
          - messageBusAzureResourceGroup
          - deployMessageBusGroup

  - resource: messageBusService
    targets:
      - target: ['consumption']
        templates:
          - messageBusServiceAzureRole
          - messageBusServiceAzureApiManagement
          - messageBusServiceAzureAppServiceConsumption
          - messageBusServiceAzureStorageAccount
          - deployMessageBusServiceRole
          - deployMessageBusServiceApiManagement
          - deployMessageBusServiceAppService
          - deployMessageBusServiceStorage
          - deployMessageBusGroupApimRoleAssignment
      - target: ['standard']
        templates:
          - messageBusServiceAzureRole
          - messageBusServiceAzureApiManagement
          - messageBusServiceAzureAppServiceConsumption
          - messageBusServiceLogicAppServicePlanStandard
          - messageBusServiceAzureStorageAccount
          - deployMessageBusServiceRole
          - deployMessageBusServiceApiManagement
          - deployMessageBusServiceAppService
          - deployMessageBusServiceLogicAppServicePlanStandard
          - deployMessageBusServiceStorage
          - deployMessageBusGroupApimRoleAssignment
  
  - resource: messageBusOps
    targets:
      - target: ['consumption', 'standard']
        templates:
          - messageBusOpsAzureAppInsights
          - deployMessageBusOpsAppInsights

  - resource: messageBusPublishChannel
    targets:
      - target: ['consumption', 'standard']
        templates:
          - messageBusPublishChannelAzureApplicationConfiguration
          - deployMessageBusOpsAppInsights

  - resource: artifactStore
    targets:
      - target: ['consumption']
        templates:
          - artifactStoreAzureIntegrationAccountBasic
          - deployArtifactStore
      - target: ['standard']
        templates:
          - artifactStoreAzureIntegrationAccountBasic
          - deployArtifactStore

  - resource: routingStore
    targets:
      - target: ['consumption', 'standard']
        templates:
          - routingStoreAzureAppConfiguration
          - routingStoreAzureKeyVault
          - routingStoreAzureApiManagement
          - deployRoutingStoreConfig
          - deployRoutingStoreVault
          - deployRoutingStoreApi

  - resource: routingManager
    targets:
      - target: ['consumption', 'standard']
        templates:
          - routingManagerAzureFunctionConsumption
          - routingManagerAzureApiManagement
          - deployRoutingManagerFunc
          - deployRoutingManagerApi

  - resource: messagingManager
    targets:
      - target: ['consumption', 'standard']
        templates:
          - messagingManagerAzureFunctionConsumption
          - messagingManagerAzureApiManagement
          - deployMessagingManagerFunc
          - deployMessagingManagerApi

  - resource: configManager
    targets:
      - target: ['consumption', 'standard']
        templates:
          - configManagerAzureApiManagement          
          - deployConfigManagerApi

  - resource: routingSlipRouter
    targets:
      - target: ['consumption']
        templates:
          - routingSlipRouterAzureLogicAppConsumption
          - deployRoutingSlipRouterAzureLogicAppConsumption
      - target: ['standard']
        templates:
          - routingSlipRouterAzureLogicAppStandard

  - resource: xmlEnvelopeWrapper
    targets:
      - target: ['consumption']
        templates:
          - xmlEnvelopeWrapperAzureLogicAppConsumption
          - deployXmlEnvelopeWrapperAzureLogicAppConsumption
      - target: ['standard']
        templates:
          - xmlEnvelopeWrapperAzureLogicAppStandard

  - resource: xmlMessageProcessor
    targets:
      - target: ['consumption']
        templates:
          - xmlMessageProcessorAzureLogicAppConsumption
          - deployXmlMessageProcessorAzureLogicAppConsumption
      - target: ['standard']
        templates:
          - xmlMessageProcessorAzureLogicAppStandard

  - resource: xmlMessageTranslator
    targets:
      - target: ['consumption']
        templates:
          - xmlMessageTranslatorAzureLogicAppConsumption
          - deployXmlMessageTranslatorAzureLogicAppConsumption
      - target: ['standard']
        templates:
          - xmlMessageTranslatorAzureLogicAppStandard

  - resource: xmlMessageValidator
    targets:
      - target: ['consumption']
        templates:
          - xmlMessageValidatorAzureLogicAppConsumption
          - deployXmlMessageValidatorAzureLogicAppConsumption
      - target: ['standard']
        templates:
          - xmlMessageValidatorAzureLogicAppStandard

  - resource: messageConstructor
    targets:
      - target: ['consumption']
        templates:
          - messageConstructorAzureLogicAppConsumption
          - deployMessageConstructorAzureLogicAppConsumption
      - target: ['standard']
        templates:
          - messageConstructorAzureLogicAppStandard

  - resource: messageResponseHandler
    targets:
      - target: ['consumption']
        templates:
          - messageResponseHandlerAzureLogicAppConsumption
          - messageResponseHandlerAzureServiceBusApiConnection
          - deployMessageResponseHandlerAzureLogicAppConsumption
          - deployMessageResponseHandlerAzureServiceBusApiConnection
      - target: ['standard']
        templates:
          - messageResponseHandlerAzureLogicAppStandard
 
  - resource: messageSuspendProcessor
    targets:
      - target: ['consumption']
        templates:
          - messageSuspendProcessorAzureLogicAppConsumption
          - messageSuspendProcessorAzureServiceBusApiConnection
          - deployMessageSuspendProcessorAzureLogicAppConsumption
          - deployMessageSuspendProcessorAzureServiceBusApiConnection
      - target: ['standard']
        templates:
          - messageSuspendProcessorAzureLogicAppStandard

  - resource: jsonDecoder
    targets:
      - target: ['consumption']
        templates:
          - jsonDecoderAzureLogicAppConsumption
          - deployJsonDecoderLogicAppConsumption
      - target: ['standard']
        templates:
          - jsonDecoderAzureLogicAppStandard

  - resource: jsonEncoder
    targets:
      - target: ['consumption']
        templates:
          - jsonEncoderAzureLogicAppConsumption
          - deployJsonEncoderLogicAppConsumption
      - target: ['standard']
        templates:
          - jsonEncoderAzureLogicAppStandard

  - resource: flatFileMessageProcessor
    targets:
      - target: ['consumption']
        templates:
          - flatFileMessageProcessorAzureLogicAppConsumption
          - deployFlatFileMessageProcessorAzureLogicAppConsumption
      - target: ['standard']
        templates:
          - flatFileMessageProcessorAzureLogicAppStandard

  - resource: systemApplicationGroup
    targets:
      - target: ['consumption', 'standard']
        templates:
          - systemApplicationAzureResourceGroup
          - deploySystemApplicationGroup
          - deploySystemApplicationGroupApimRoleAssignment

  - resource: systemApplicationService
    targets:
      - target: ['standard']
        templates:
          - systemApplicationAzureLogicAppStandard
          - systemApplicationAzureServiceBusApiConnection
          - systemApplicationAzureServiceBusApiConnectionAccessPolicy
          - systemApplicationAzureLogicAppStandardWorkflows
          - systemApplicationAzureLogicAppStandardWorkflowsVsCode
          - systemApplicationAzureLogicAppStandardWorkflowsWorkflowDesigntime
          - deploySystemApplicationAzureLogicAppStandard
          - deploySystemApplicationAzureServiceBusApiConnection
          - deploySystemApplicationAzureServiceBusApiConnectionAccessPolicy

  # ------------------------------------------------------------------------------
  # Application Group and Standard Logic App
  # ------------------------------------------------------------------------------

{%- for application in model.migration_target.message_bus.applications %}
  {% assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" %}
  {% if application.name != 'System Application' %}
  - resource: applicationGroup{{ app_name }}
    targets:
      - target: ['consumption', 'standard']
        templates:
          - applicationAzureResourceGroup{{ app_name }}
          - deployApplicationGroup{{ app_name }}
          - deployApplicationGroupApimRoleAssignment{{ app_name }}

  - resource: applicationService{{ app_name }}
    targets:
      - target: ['standard']
        templates:
          - {{ app_name }}AzureLogicAppStandard
          - {{ app_name }}AzureLogicAppStandardWorkflows
          - {{ app_name }}AzureLogicAppStandardWorkflowsVsCode
          - {{ app_name }}AzureLogicAppStandardWorkflowsWorkflowDesigntime
          - deploy{{ app_name }}AzureLogicAppStandard

  {%- endif %}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications -%}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for message in application.messages %}
    {% assign message_name = message.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: applicationMessage{{ app_name }}{{ message_name }}
    targets:
      - target: ['consumption', 'standard']
        templates:
          - deploySchema{{ app_name }}{{ message_name }}
          - messagesAzureIntegrationAccountSchema{{ app_name }}{{ message_name }}
    {%- assign routing_property_count = message.routing_properties | size -%}
    {%- if routing_property_count > 0 %}
          - deployMessageRoutingPropertyConfiguration{{ app_name }}{{ message_name }}          
          - messageRoutingPropertyConfiguration{{ app_name }}{{ message_name }}
    {%- endif %}
    {%- for transform in message.message_transforms %}
      {% assign transform_name = transform.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
          - deployMap{{ app_name }}{{ message_name }}{{ transform_name }}    
          - messagesAzureIntegrationAccountMap{{ app_name }}{{ message_name }}{{ transform_name }}
    {%- endfor %}
  {%- endfor %}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for endpoint in application.endpoints -%}
    {%- if endpoint.endpoint_type == "Adapter" and endpoint.adapter_protocol == "FTP" and endpoint.message_exchange_pattern == "Accept" %}
      {% assign endpoint_name = endpoint.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: ftpReceiveAdapterEndpoint{{ app_name }}{{ endpoint_name }}
    targets:
      - target: ['consumption']
        templates:
          - ftpReceiveAzureFtpConnectionEndpointConsumption{{ app_name }}{{ endpoint_name }}
          - ftpReceiveAzureServiceBusConnectionEndpointConsumption{{ app_name }}{{ endpoint_name }}
          - ftpReceiveAzureAdapterEndpointConsumption{{ app_name }}{{ endpoint_name }}          
          - receiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - receiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - receiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
          - deployFtpReceiveAdapterLogicAppConsumption{{ app_name }}{{ endpoint_name }}
          - deployFtpReceiveAdapterFtpApiConnection{{ app_name }}{{ endpoint_name }}
          - deployFtpReceiveAdapterServiceBusApiConnection{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - deployReceiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
      - target: ['standard']
        templates:
          - ftpReceiveAzureFtpConnectionEndpointStandard{{ app_name }}{{ endpoint_name }}
          - ftpReceiveAzureServiceBusConnectionEndpointStandard{{ app_name }}{{ endpoint_name }}
          - ftpReceiveAzureAdapterEndpointStandard{{ app_name }}{{ endpoint_name }}
          - receiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - receiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - receiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
          - deployFtpReceiveAdapterFtpApiConnection{{ app_name }}{{ endpoint_name }}
          - deployFtpReceiveAdapterServiceBusApiConnection{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - deployReceiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
    {%- endif %}
  {%- endfor %}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for endpoint in application.endpoints -%}
    {%- if endpoint.endpoint_type == "Adapter" and endpoint.adapter_protocol == "FTP" and endpoint.message_exchange_pattern == "Send" %}
      {% assign endpoint_name = endpoint.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: ftpSendAdapterEndpoint{{ app_name }}{{ endpoint_name }}
    targets:
      - target: ['consumption']
        templates:
          - deployFtpSendAdapterLogicApp{{ app_name }}{{ endpoint_name }}
          - deployFtpSendAdapterApiConnection{{ app_name }}{{ endpoint_name }}
          - ftpSendAzureConnectionEndpointConsumption{{ app_name }}{{ endpoint_name }}
          - ftpSendAzureAdapterEndpoint{{ app_name }}{{ endpoint_name }}
      - target: ['standard']
        templates:
          - deployFtpSendAdapterApiConnection{{ app_name }}{{ endpoint_name }}
          - ftpSendAzureConnectionEndpointStandard{{ app_name }}{{ endpoint_name }}
     {%- endif %}
  {%- endfor %}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for endpoint in application.endpoints -%}
    {%- if endpoint.endpoint_type == "Adapter" and endpoint.adapter_protocol == "FILE" and endpoint.message_exchange_pattern == "Accept" %}
      {% assign endpoint_name = endpoint.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: fileReceiveAdapterEndpoint{{ app_name }}{{ endpoint_name }}
    targets:
      - target: ['consumption']
        templates:
          - fileReceiveAzureFileConnectionEndpointConsumption{{ app_name }}{{ endpoint_name }}
          - fileReceiveAzureServiceBusConnectionEndpointConsumption{{ app_name }}{{ endpoint_name }}
          - fileReceiveAzureAdapterEndpoint{{ app_name }}{{ endpoint_name }}
          - receiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - receiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - receiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
          - deployFileReceiveAdapterLogicApp{{ app_name }}{{ endpoint_name }}
          - deployFileReceiveAdapterFileApiConnection{{ app_name }}{{ endpoint_name }}
          - deployFileReceiveAdapterServiceBusApiConnection{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - deployReceiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
      - target: ['standard']
        templates:
          - fileReceiveAzureFileConnectionEndpointStandard{{ app_name }}{{ endpoint_name }}
          - fileReceiveAzureServiceBusConnectionEndpointStandard{{ app_name }}{{ endpoint_name }}
          - fileReceiveAzureAdapterEndpoint{{ app_name }}{{ endpoint_name }}
          - receiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - receiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - receiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
          - deployFileReceiveAdapterLogicApp{{ app_name }}{{ endpoint_name }}
          - deployFileReceiveAdapterFileApiConnection{{ app_name }}{{ endpoint_name }}
          - deployFileReceiveAdapterServiceBusApiConnection{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - deployReceiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
    {%- endif %}
  {%- endfor %}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for endpoint in application.endpoints -%}
    {%- if endpoint.endpoint_type == "Adapter" and endpoint.adapter_protocol == "FILE" and endpoint.message_exchange_pattern == "Send" %}
      {% assign endpoint_name = endpoint.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: fileSendAdapterEndpoint{{ app_name }}{{ endpoint_name }}
    targets:
      - target: ['consumption']
        templates:
          - deployFileSendAdapterLogicApp{{ app_name }}{{ endpoint_name }}
          - deployFileSendAdapterApiConnection{{ app_name }}{{ endpoint_name }}
          - fileSendAzureConnectionEndpointConsumption{{ app_name }}{{ endpoint_name }}
          - fileSendAzureAdapterEndpoint{{ app_name }}{{ endpoint_name }}
      - target: ['standard']
        templates:
          - deployFileSendAdapterLogicApp{{ app_name }}{{ endpoint_name }}
          - deployFileSendAdapterApiConnection{{ app_name }}{{ endpoint_name }}
          - fileSendAzureConnectionEndpointStandard{{ app_name }}{{ endpoint_name }}
          - fileSendAzureAdapterEndpoint{{ app_name }}{{ endpoint_name }}
     {%- endif %}
  {%- endfor %}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for endpoint in application.endpoints -%}
    {%- if endpoint.endpoint_type == "Adapter" and endpoint.adapter_protocol == "HTTP" and ( endpoint.message_exchange_pattern == "ReceiveResponse" or endpoint.message_exchange_pattern == "Receive" ) %}
      {% assign endpoint_name = endpoint.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: httpReceiveAdapterEndpoint{{ app_name }}{{ endpoint_name }}
    targets:
      - target: ['consumption', 'standard']
        templates:          
          - httpReceiveAzureAdapterEndpoint{{ app_name }}{{ endpoint_name }}          
          - receiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - receiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - receiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
          - deployHttpReceiveAdapterLogicApp{{ app_name }}{{ endpoint_name }}                    
          - deployReceiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - deployReceiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
    {%- endif %}
  {%- endfor %}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for channel in application.channels %}
    {%- if channel.channel_type == "PublishSubscribe" %}
      {%- assign channel_name = channel.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" -%}
      {%- for subscription in channel.subscriptions %}
        {% assign subscription_name = subscription.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: topicSubscription{{ app_name }}{{ channel_name }}{{ subscription_name }}
    targets:
      - target: ['consumption', 'standard']
        templates:
          - deployTopicSubscription{{ app_name }}{{ channel_name }}{{ subscription_name }}
          - topicSubscriptionAzureServiceBus{{ app_name }}{{ channel_name }}{{ subscription_name }}
      {%- endfor -%}
    {%- endif -%}
  {%- endfor -%}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for intermediary in application.intermediaries %}
    {%- if intermediary.intermediary_type == "MessageRouter" and intermediary.message_router_type == "ProcessManager" and intermediary.activator == true %}
      {% assign intermediary_name = intermediary.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: activatableProcessManager{{ app_name }}{{ intermediary_name }}
    targets:
      - target: ['consumption', 'standard']
        templates:
          - deployProcessManagerApiConnection{{ app_name }}{{ intermediary_name }}
          - deployProcessManagerConfigurationEntry{{ app_name }}{{ intermediary_name }}
          - deployProcessManagerLogicApp{{ app_name }}{{ intermediary_name }}
          - deployProcessManagerRoutingSlip{{ app_name }}{{ intermediary_name }}
          - activatableProcessManagerAzureApiConnection{{ app_name }}{{ intermediary_name }}
          - activatableProcessManagerAzureConfigurationEntry{{ app_name }}{{ intermediary_name }}
          - activatableProcessManagerAzureLogicApp{{ app_name }}{{ intermediary_name }}
          - activatableProcessManagerRoutingSlip{{ app_name }}{{ intermediary_name }}          
        snippets:
          - activatableWorkflowDefinition{{ app_name }}{{ intermediary_name }}
          - activatableWorkflowParametersDefinition{{ app_name }}{{ intermediary_name }}
          - parameterMessageBusResourceGroup{{ app_name }}{{ intermediary_name }}
          - parameterSystemApplicationResourceGroup{{ app_name }}{{ intermediary_name }}
          - parameterApimService{{ app_name }}{{ intermediary_name }}
          - parameterApimRetryPolicy{{ app_name }}{{ intermediary_name }}
          - parameterApimSubscriptionKey{{ app_name }}{{ intermediary_name }}
          - parameterMessageSuspendProcessorLogicApp{{ app_name }}{{ intermediary_name }}
          - parameterSuspendQueueTopic{{ app_name }}{{ intermediary_name }}
          - parameterRoutingSlipRouterLogicApp{{ app_name }}{{ intermediary_name }}
          - parameterRoutingSlipRouterRetryPolicy{{ app_name }}{{ intermediary_name }}
          - parameterIntegrationAccount{{ app_name }}{{ intermediary_name }}
          - parameterServiceBusTopic{{ app_name }}{{ intermediary_name }}
          - parameterServiceBusTopicSubscribeApiConnection{{ app_name }}{{ intermediary_name }}
          - parameterServiceBusTopicPublishApiConnection{{ app_name }}{{ intermediary_name }}
          - parameterServiceBusTopicSubscription{{ app_name }}{{ intermediary_name }}
          - parameterServiceBusRecurrenceFrequency{{ app_name }}{{ intermediary_name }}
          - parameterServiceBusRecurrenceInterval{{ app_name }}{{ intermediary_name }}
          - parameterScenario{{ app_name }}{{ intermediary_name }}
          - parameterScenarioStep{{ app_name }}{{ intermediary_name }}
          - parameterTags{{ app_name }}{{ intermediary_name }}
          - propertyTags{{ app_name }}{{ intermediary_name }}
          - propertyIntegrationAccount{{ app_name }}{{ intermediary_name }}
          - variableApimService{{ app_name }}{{ intermediary_name }}
          - variableConfigurationManager{{ app_name }}{{ intermediary_name }}
          - variableIntegrationAccount{{ app_name }}{{ intermediary_name }}
          - variableMessagingManager{{ app_name }}{{ intermediary_name }}
          - variableRoutingManager{{ app_name }}{{ intermediary_name }}
          - variableRoutingSlipRouterLogicApp{{ app_name }}{{ intermediary_name }}
          - variableMessageSuspendProcessorLogicApp{{ app_name }}{{ intermediary_name }}
          - variableServiceBusSubscribeApiConnection{{ app_name }}{{ intermediary_name }}
          - variableServiceBusPublishApiConnection{{ app_name }}{{ intermediary_name }}
          - channelServiceBusTopicTrigger{{ app_name }}{{ intermediary_name }}
          - channelServiceBusTopicSend{{ app_name }}{{ intermediary_name }}
          - variablePlaceHolder{{ app_name }}{{ intermediary_name }}
          - variableInitializeConfiguration{{ app_name }}{{ intermediary_name }}
          - variableInitializeErrorMessage{{ app_name }}{{ intermediary_name }}
          - variableInitializeFaultMessage{{ app_name }}{{ intermediary_name }}
          - variableInitializeMessageType{{ app_name }}{{ intermediary_name }}
          - variableInitializeStatusCode{{ app_name }}{{ intermediary_name }}
          - messagePlaceHolder{{ app_name }}{{ intermediary_name }}
          - activityContainerPlaceHolder{{ app_name }}{{ intermediary_name }}
          - activityContainerWorkflow{{ app_name }}{{ intermediary_name }}
          - activityContainerTask{{ app_name }}{{ intermediary_name }}
          - activityContainerDecision{{ app_name }}{{ intermediary_name }}
          - activityContainerDecisionBranch{{ app_name }}{{ intermediary_name }}
          - activityPlaceHolder{{ app_name }}{{ intermediary_name }}
          - activityCodeExpression{{ app_name }}{{ intermediary_name }}
          - activityMessageTransform{{ app_name }}{{ intermediary_name }}
          - activityMessageConstruction{{ app_name }}{{ intermediary_name }}
          - activityInvokeWorkflow{{ app_name }}{{ intermediary_name }}
          - actionDecodeServiceBusMessage{{ app_name }}{{ intermediary_name }}
          - actionGetConfiguration{{ app_name }}{{ intermediary_name }}
    {%- endif %}
  {%- endfor %}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for intermediary in application.intermediaries %}
    {%- if intermediary.intermediary_type == "MessageRouter" and intermediary.message_router_type == "ProcessManager" and intermediary.activator == false %}
      {% assign intermediary_name = intermediary.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: invokableProcessManager{{ app_name }}{{ intermediary_name }}
    targets:
      - target: ['consumption', 'standard']
        templates:
          - deployProcessManagerApiConnection{{ app_name }}{{ intermediary_name }}
          - deployProcessManagerLogicApp{{ app_name }}{{ intermediary_name }}
          - invokableProcessManagerAzureApiConnection{{ app_name }}{{ intermediary_name }}
          - invokableProcessManagerAzureLogicApp{{ app_name }}{{ intermediary_name }}
        snippets:
          - invokableWorkflowDefinition{{ app_name }}{{ intermediary_name }}
          - invokableWorkflowParametersDefinition{{ app_name }}{{ intermediary_name }}
          - parameterMessageBusResourceGroup{{ app_name }}{{ intermediary_name }}
          - parameterApimService{{ app_name }}{{ intermediary_name }}
          - parameterApimRetryPolicy{{ app_name }}{{ intermediary_name }}
          - parameterApimSubscriptionKey{{ app_name }}{{ intermediary_name }}
          - parameterRoutingSlipRouterLogicApp{{ app_name }}{{ intermediary_name }}
          - parameterRoutingSlipRouterRetryPolicy{{ app_name }}{{ intermediary_name }}
          - parameterIntegrationAccount{{ app_name }}{{ intermediary_name }}
          - parameterServiceBusTopicPublishApiConnection{{ app_name }}{{ intermediary_name }}
          - parameterScenario{{ app_name }}{{ intermediary_name }}
          - parameterScenarioStep{{ app_name }}{{ intermediary_name }}
          - parameterTags{{ app_name }}{{ intermediary_name }}
          - propertyTags{{ app_name }}{{ intermediary_name }}
          - propertyIntegrationAccount{{ app_name }}{{ intermediary_name }}
          - variableApimService{{ app_name }}{{ intermediary_name }}
          - variableConfigurationManager{{ app_name }}{{ intermediary_name }}
          - variableIntegrationAccount{{ app_name }}{{ intermediary_name }}
          - variableMessagingManager{{ app_name }}{{ intermediary_name }}
          - variableRoutingManager{{ app_name }}{{ intermediary_name }}
          - variableRoutingSlipRouterLogicApp{{ app_name }}{{ intermediary_name }}
          - variableServiceBusPublishApiConnection{{ app_name }}{{ intermediary_name }}
          - channelHttpTrigger{{ app_name }}{{ intermediary_name }}
          - channelServiceBusTopicSend{{ app_name }}{{ intermediary_name }}
          - variablePlaceHolder{{ app_name }}{{ intermediary_name }}
          - variableInitializeConfiguration{{ app_name }}{{ intermediary_name }}
          - variableInitializeErrorMessage{{ app_name }}{{ intermediary_name }}
          - variableInitializeFaultMessage{{ app_name }}{{ intermediary_name }}
          - variableInitializeMessageType{{ app_name }}{{ intermediary_name }}
          - variableInitializeStatusCode{{ app_name }}{{ intermediary_name }}
          - messagePlaceHolder{{ app_name }}{{ intermediary_name }}
          - activityContainerPlaceHolder{{ app_name }}{{ intermediary_name }}
          - activityContainerTask{{ app_name }}{{ intermediary_name }}
          - activityContainerDecision{{ app_name }}{{ intermediary_name }}
          - activityContainerDecisionBranch{{ app_name }}{{ intermediary_name }}
          - activityPlaceHolder{{ app_name }}{{ intermediary_name }}
          - activityCodeExpression{{ app_name }}{{ intermediary_name }}
          - activityMessageTransform{{ app_name }}{{ intermediary_name }}
          - activityMessageConstruction{{ app_name }}{{ intermediary_name }}
          - activityInvokeWorkflow{{ app_name }}{{ intermediary_name }}
          - actionGetConfiguration{{ app_name }}{{ intermediary_name }}
    {%- endif %}
  {%- endfor %}
{%- endfor %}

  # ------------------------------------------------------------------------------
  # BizTalk specific resources
  # ------------------------------------------------------------------------------

  - resource: topicChannel
    targets:
      - target: ['consumption', 'standard']
        templates:
          - topicChannelAzureServiceBusStandard
          - namespaceAzureServiceBusStandard
          - deployNamespace
          - deployTopicChannel

  - resource: topicResponseChannel
    targets:
      - target: ['consumption', 'standard']
        templates:
          - topicResponseChannelAzureServiceBusStandard
          - deployTopicResponseChannel

  - resource: suspendQueueChannel
    targets:
      - target: ['consumption', 'standard']
        templates:
          - suspendQueueChannelAzureServiceBusTopic
          - deploySuspendQueueChannel

  - resource: contentDemoter
    targets:
      - target: ['consumption']
        templates:
          - contentDemoterAzureLogicAppConsumption
          - deployContentDemoterConsumption
      - target: ['standard']
        templates:
          - contentDemoterAzureLogicAppStandard

  - resource: contentPromoter
    targets:
      - target: ['consumption']
        templates:
          - contentPromoterAzureLogicAppConsumption
          - deployContentPromoterConsumption
      - target: ['standard']
        templates:
          - contentPromoterAzureLogicAppStandard

  - resource: topicPublisherApiConnection
    targets:
      - target: ['consumption']
        templates:
          - topicPublisherAzureApiConnectionConsumption
          - deployTopicPublisherApiConnectionConsumption
      - target: ['standard']
        templates:
          - topicPublisherAzureApiConnectionStandard

  - resource: topicPublisher
    targets:
      - target: ['consumption']
        templates:
          - topicPublisherAzureLogicAppConsumption
          - deployTopicPublisherConsumption
      - target: ['standard']
        templates:
          - topicPublisherAzureLogicAppStandard

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for intermediary in application.intermediaries %}
    {%- if intermediary.intermediary_type == "MessageRouter" and intermediary.message_router_type == "MessageSubscriber" %}
      {% assign intermediary_name = intermediary.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: topicSubscriber{{ app_name }}{{ intermediary_name }}
    targets:
      - target: ['consumption']
        templates:
          - topicSubscriberAzureApiConnectionConsumption{{ app_name }}{{ intermediary_name }}
          - topicSubscriberAzureLogicApp{{ app_name }}{{ intermediary_name }}
          - sendRoutingSlipConfiguration{{ app_name }}{{ intermediary_name }}
          - sendConfigurationEntry{{ app_name }}{{ intermediary_name }}
          - sendRoutingPropertyConfiguration{{ app_name }}{{ intermediary_name }}
          - deployTopicSubscriberApiConnection{{ app_name }}{{ intermediary_name }}
          - deployTopicSubscriberLogicApp{{ app_name }}{{ intermediary_name }}
          - deploySendRoutingSlipConfiguration{{ app_name }}{{ intermediary_name }}
          - deploySendConfigurationEntry{{ app_name }}{{ intermediary_name }}
          - deploySendRoutingPropertyConfiguration{{ app_name }}{{ intermediary_name }}
      - target: ['standard']
        templates:
          - topicSubscriberAzureApiConnectionStandard{{ app_name }}{{ intermediary_name }}
          - topicSubscriberAzureLogicApp{{ app_name }}{{ intermediary_name }}
          - sendRoutingSlipConfiguration{{ app_name }}{{ intermediary_name }}
          - sendConfigurationEntry{{ app_name }}{{ intermediary_name }}
          - sendRoutingPropertyConfiguration{{ app_name }}{{ intermediary_name }}
          - deployTopicSubscriberApiConnection{{ app_name }}{{ intermediary_name }}
          - deployTopicSubscriberLogicApp{{ app_name }}{{ intermediary_name }}
          - deploySendRoutingSlipConfiguration{{ app_name }}{{ intermediary_name }}
          - deploySendConfigurationEntry{{ app_name }}{{ intermediary_name }}
          - deploySendRoutingPropertyConfiguration{{ app_name }}{{ intermediary_name }}
    {%- endif %}
  {%- endfor %}
{%- endfor %}

{%- if deploy_data_gateway == true %}
  - resource: dataGateway
    targets:
      - target: ['consumption', 'standard']
        templates:
          - onPremiseDataGateway
          - deployOnPremiseDataGateway
{%- endif %}