{%- for application in model.migration_target.message_bus.applications %}
  {%- for endpoint in application.endpoints -%}
    {%- if endpoint.endpoint_type == "Adapter" and endpoint.adapter_protocol == "FILE" %}      
      {%- deploy_data_gateway = true -%}
    {%- endif %}
  {%- endfor %}
{%- endfor %}
#
# A target model is produced by analyzing the source model and adding logical messaging
# objects that represent the source model artifacts.
#
# As part of the analysis stage, each logical messaging object is associated with a resource
# map key.  This key is used to look up the resources in this configuration file and
# associated template configuration files and the discovered resources are added to the target model.
#
# The configuration files themselves can also be rendered using the Liquid template language.
#

# A resource associates the templates that are used to represent and deploy the resource in Azure
# keyed by the AIS target environment.  The target environment is an enumeration defined in the model
# and determines what environment the templates support.
resources:

  # ------------------------------------------------------------------------------
  # AIS generic resources
  # ------------------------------------------------------------------------------

  - resource: deployment
    targets:
      - target: ['consumption']
        templates:
          - deployConsumptionResources
      - target: ['consumptionlite']
        templates:
          - deployConsumptionLiteResources
      - target: ['standard']
        templates:
          - deployStandardResources
      - target: ['standardlite']
        templates:
          - deployStandardLiteResources

  - resource: messageBusGroup
    targets:
      - target: ['consumption', 'standard']
        templates:
          - messageBusAzureResourceGroup
          - deployMessageBusGroup

  - resource: messageBusService
    targets:
      - target: ['consumption']
        templates:
          - messageBusServiceAzureRole
          - messageBusServiceAzureApiManagement
          - messageBusServiceAzureAppServiceConsumption
          - messageBusServiceAzureStorageAccount
          - deployMessageBusServiceRole
          - deployMessageBusServiceApiManagement
          - deployMessageBusServiceAppService
          - deployMessageBusServiceStorage
          - deployMessageBusGroupApimRoleAssignment
          - configCacheUpdaterAzureLogicAppConsumption
          - configCacheUpdaterEventGridApiConnectionConsumption
          - deployConfigCacheUpdaterAzureLogicAppConsumption
          - deployConfigCacheUpdaterEventGridApiConnectionConsumption
          - deployConfigCacheUpdaterAppConfigRoleAssignmentConsumption
      - target: ['standard']
        templates:
          - messageBusServiceAzureRole
          - messageBusServiceAzureApiManagement
          - messageBusServiceAzureAppServiceConsumption
          - messageBusServiceLogicAppServicePlanStandard
          - messageBusServiceAzureStorageAccount
          - messageBusApplicationAzureLogicAppStandard
          - messageBusApplicationAzureLogicAppStandardWorkflows
          - messageBusApplicationAzureLogicAppStandardWorkflowsVsCode
          - messageBusApplicationAzureLogicAppStandardWorkflowsWorkflowDesigntime
          - messageBusApplicationAzureEventGridApiConnectionStandard
          - messageBusApplicationAzureEventGridApiConnectionAccessPolicy
          - configCacheUpdaterAzureLogicAppStandard
          - deployMessageBusServiceRole
          - deployMessageBusServiceApiManagement
          - deployMessageBusServiceAppService
          - deployMessageBusServiceLogicAppServicePlanStandard
          - deployMessageBusServiceStorage
          - deployMessageBusGroupApimRoleAssignment
          - deployMessageBusAzureLogicAppStandard
          - deployMessageBusAzureEventGridApiConnectionStandard
          - deployMessageBusAzureEventGridApiConnectionAccessPolicyStandard
          - deployMessageBusAppConfigStoreRoleAssignmentStandard
          - configCacheUpdaterAzureLogicAppConsumption
          - configCacheUpdaterEventGridApiConnectionConsumption
          - deployConfigCacheUpdaterAzureLogicAppConsumption
          - deployConfigCacheUpdaterEventGridApiConnectionConsumption
          - deployConfigCacheUpdaterAppConfigRoleAssignmentConsumption
  
  - resource: messageBusOps
    targets:
      - target: ['consumption', 'standard']
        templates:
          - messageBusOpsAzureAppInsights
          - deployMessageBusOpsAppInsights

  - resource: messageBusPublishChannel
    targets:
      - target: ['consumption', 'standard']
        templates:
          - messageBusPublishChannelAzureApplicationConfiguration
          - deployMessageBusOpsAppInsights

  - resource: artifactStore
    targets:
      - target: ['consumption']
        templates:
          - artifactStoreAzureIntegrationAccountBasic
          - deployArtifactStore
      - target: ['standard']
        templates:
          - artifactStoreAzureIntegrationAccountBasic
          - deployArtifactStore

  - resource: routingStore
    targets:
      - target: ['consumption', 'standard']
        templates:
          - routingStoreAzureAppConfiguration
          - routingStoreAzureKeyVault
          - routingStoreAzureApiManagement
          - deployRoutingStoreConfig
          - deployRoutingStoreVault
          - deployRoutingStoreApi

  - resource: routingManager
    targets:
      - target: ['consumption', 'standard']
        templates:
          - routingManagerAzureFunctionConsumption
          - routingManagerAzureApiManagement
          - deployRoutingManagerFunc
          - deployRoutingManagerApi

  - resource: messagingManager
    targets:
      - target: ['consumption', 'standard']
        templates:
          - messagingManagerAzureFunctionConsumption
          - messagingManagerAzureApiManagement
          - deployMessagingManagerFunc
          - deployMessagingManagerApi

  - resource: configManager
    targets:
      - target: ['consumption', 'standard']
        templates:
          - configManagerAzureApiManagement          
          - deployConfigManagerApi

# -----------------------------
# The built-in XSLT option Logic Apps Standard doesn't (yet) support BizTalk maps,
# So we're using the existing Consumption offering to perform translation.
# The xmlMessageTranslator has a dependency on the RoutingSlipRouter, so we need both
# Standard and Consumption versions of this workflow.
# -----------------------------
#  - resource: routingSlipRouter
#    targets:
#      - target: ['consumption']
#        templates:
#          - routingSlipRouterAzureLogicAppConsumption
#          - deployRoutingSlipRouterAzureLogicAppConsumption
#      - target: ['consumptionlite']
#        templates:
#          - routingSlipRouterAzureLogicAppConsumption
#      - target: ['standard', 'standardlite']
#        templates:
#          - routingSlipRouterAzureLogicAppStandard

  - resource: routingSlipRouter
    targets:
      - target: ['consumption', 'standard']
        templates:
          - routingSlipRouterAzureLogicAppConsumption
          - deployRoutingSlipRouterAzureLogicAppConsumption
      - target: ['consumptionlite', 'standardlite']
        templates:
          - routingSlipRouterAzureLogicAppConsumption
      - target: ['standard', 'standardlite']
        templates:
          - routingSlipRouterAzureLogicAppStandard

  - resource: xmlEnvelopeWrapper
    targets:
      - target: ['consumption']
        templates:
          - xmlEnvelopeWrapperAzureLogicAppConsumption
          - deployXmlEnvelopeWrapperAzureLogicAppConsumption
      - target: ['consumptionlite']
        templates:
          - xmlEnvelopeWrapperAzureLogicAppConsumption
      - target: ['standard', 'standardlite']
        templates:
          - xmlEnvelopeWrapperAzureLogicAppStandard

  - resource: xmlMessageProcessor
    targets:
      - target: ['consumption']
        templates:
          - xmlMessageProcessorAzureLogicAppConsumption
          - deployXmlMessageProcessorAzureLogicAppConsumption
      - target: ['consumptionlite']
        templates:
          - xmlMessageProcessorAzureLogicAppConsumption
      - target: ['standard', 'standardlite']
        templates:
          - xmlMessageProcessorAzureLogicAppStandard

# -----------------------------
# The built-in XSLT option Logic Apps Standard doesn't (yet) support BizTalk maps,
# So we're using the existing Consumption offering to perform translation.
# -----------------------------
# - resource: xmlMessageTranslator
#    targets:
#      - target: ['consumption']
#        templates:
#          - xmlMessageTranslatorAzureLogicAppConsumption
#          - deployXmlMessageTranslatorAzureLogicAppConsumption
#      - target: ['consumptionlite']
#        templates:
#          - xmlMessageTranslatorAzureLogicAppConsumption
#      - target: ['standard', 'standardlite']
#        templates:
#          - xmlMessageTranslatorAzureLogicAppStandard

  - resource: xmlMessageTranslator
    targets:
      - target: ['consumption', 'standard']
        templates:
          - xmlMessageTranslatorAzureLogicAppConsumption
          - deployXmlMessageTranslatorAzureLogicAppConsumption
      - target: ['consumptionlite', 'standardlite']
        templates:
          - xmlMessageTranslatorAzureLogicAppConsumption
      - target: ['standard']
        templates:
          - xmlMessageTranslatorLiteAzureLogicAppConsumption
          - deployXmlMessageTranslatorLiteAzureLogicAppConsumption

  - resource: xmlMessageValidator
    targets:
      - target: ['consumption']
        templates:
          - xmlMessageValidatorAzureLogicAppConsumption
          - deployXmlMessageValidatorAzureLogicAppConsumption
      - target: ['consumptionlite']
        templates:
          - xmlMessageValidatorAzureLogicAppConsumption
      - target: ['standard', 'standardlite']
        templates:
          - xmlMessageValidatorAzureLogicAppStandard

  - resource: messageConstructor
    targets:
      - target: ['consumption']
        templates:
          - messageConstructorAzureLogicAppConsumption
          - deployMessageConstructorAzureLogicAppConsumption
      - target: ['consumptionlite']
        templates:
          - messageConstructorAzureLogicAppConsumption
      - target: ['standard', 'standardlite']
        templates:
          - messageConstructorAzureLogicAppStandard

  - resource: messageResponseHandler
    targets:
      - target: ['consumption']
        templates:
          - messageResponseHandlerAzureLogicAppConsumption
          - messageResponseHandlerAzureServiceBusApiConnectionConsumption
          - deployMessageResponseHandlerAzureLogicAppConsumption
          - deployMessageResponseHandlerAzureServiceBusApiConnectionConsumption
      - target: ['consumptionlite']
        templates:
          - messageResponseHandlerAzureLogicAppConsumption
      - target: ['standard', 'standardlite']
        templates:
          - messageResponseHandlerAzureLogicAppStandard
 
  - resource: messageSuspendProcessor
    targets:
      - target: ['consumption']
        templates:
          - messageSuspendProcessorAzureLogicAppConsumption
          - messageSuspendProcessorAzureServiceBusApiConnectionConsumption
          - deployMessageSuspendProcessorAzureLogicAppConsumption
          - deployMessageSuspendProcessorAzureServiceBusApiConnection
      - target: ['consumptionlite']
        templates:
          - messageSuspendProcessorAzureLogicAppConsumption
      - target: ['standard', 'standardlite']
        templates:
          - messageSuspendProcessorAzureLogicAppStandard

  - resource: jsonDecoder
    targets:
      - target: ['consumption']
        templates:
          - jsonDecoderAzureLogicAppConsumption
          - deployJsonDecoderLogicAppConsumption
      - target: ['consumptionlite']
        templates:
          - jsonDecoderAzureLogicAppConsumption
      - target: ['standard', 'standardlite']
        templates:
          - jsonDecoderAzureLogicAppStandard

  - resource: jsonEncoder
    targets:
      - target: ['consumption']
        templates:
          - jsonEncoderAzureLogicAppConsumption
          - deployJsonEncoderLogicAppConsumption
      - target: ['consumptionlite']
        templates:
          - jsonEncoderAzureLogicAppConsumption
      - target: ['standard', 'standardlite']
        templates:
          - jsonEncoderAzureLogicAppStandard

  - resource: flatFileMessageProcessor
    targets:
      - target: ['consumption']
        templates:
          - flatFileMessageProcessorAzureLogicAppConsumption
          - deployFlatFileMessageProcessorAzureLogicAppConsumption
      - target: ['consumptionlite']
        templates:
          - flatFileMessageProcessorAzureLogicAppConsumption
      - target: ['standard', 'standardlite']
        templates:
          - flatFileMessageProcessorAzureLogicAppStandard

  - resource: systemApplicationGroup
    targets:
      - target: ['consumption', 'standard']
        templates:
          - systemApplicationAzureResourceGroup
          - deploySystemApplicationGroup
          - deploySystemApplicationGroupApimRoleAssignment

  - resource: systemApplicationService
    targets:
      - target: ['standard']
        templates:
          - systemApplicationAzureLogicAppStandard
          - systemApplicationAzureServiceBusApiConnectionStandard
          - systemApplicationAzureServiceBusApiConnectionAccessPolicy
          - systemApplicationAzureLogicAppStandardWorkflows
          - systemApplicationAzureLogicAppStandardWorkflowsVsCode
          - systemApplicationAzureLogicAppStandardWorkflowsWorkflowDesigntime
          - deploySystemApplicationAzureLogicAppStandard
          - deploySystemApplicationAzureServiceBusApiConnection
          - deploySystemApplicationAzureServiceBusApiConnectionAccessPolicy

  # ------------------------------------------------------------------------------
  # Application Group and Standard Logic App
  # ------------------------------------------------------------------------------

{%- for application in model.migration_target.message_bus.applications %}
  {% assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" %}
  {% if application.name != 'System Application' %}
  - resource: applicationGroup{{ app_name }}
    targets:
      - target: ['consumption', 'standard', 'consumptionlite', 'standardlite']
        templates:
          - applicationAzureResourceGroup{{ app_name }}
          - deployApplicationGroup{{ app_name }}
          - deployApplicationGroupApimRoleAssignment{{ app_name }}

  - resource: applicationService{{ app_name }}
    targets:
      - target: ['standard', 'standardlite']
        templates:
          - {{ app_name }}AzureLogicAppStandard
          - {{ app_name }}AzureLogicAppStandardWorkflows
          - {{ app_name }}AzureLogicAppStandardWorkflowsVsCode
          - {{ app_name }}AzureLogicAppStandardWorkflowsWorkflowDesigntime
          - deploy{{ app_name }}AzureLogicAppStandard

  {%- endif %}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications -%}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for message in application.messages %}
    {% assign message_name = message.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: applicationMessage{{ app_name }}{{ message_name }}
    targets:
      - target: ['consumption', 'standard', 'consumptionlite', 'standardlite']
        templates:
          - deploySchema{{ app_name }}{{ message_name }}
          - messagesXmlSchemaConsumption{{ app_name }}{{ message_name }}
    {%- assign routing_property_count = message.routing_properties | size -%}
    {%- if routing_property_count > 0 %}
          - deployMessageRoutingPropertyConfiguration{{ app_name }}{{ message_name }}          
          - messageRoutingPropertyConfiguration{{ app_name }}{{ message_name }}
    {%- endif %}
      - target: ['standard', 'standardlite']
        templates:
          - messagesXmlSchemaStandard{{ app_name }}{{ message_name }}
      - target: ['consumption', 'standard', 'consumptionlite', 'standardlite']
        templates:
    {%- for transform in message.message_transforms %}
      {% assign transform_name = transform.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
      - target: ['consumption', 'standard', 'consumptionlite', 'standardlite']
        templates:
          - deployMap{{ app_name }}{{ message_name }}{{ transform_name }}
          - messagesXmlMapConsumption{{ app_name }}{{ message_name }}{{ transform_name }}
      - target: ['standard', 'standardlite']
        templates:
          - messagesXmlMapStandard{{ app_name }}{{ message_name }}{{ transform_name }}
    {%- endfor %}
  {%- endfor %}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for endpoint in application.endpoints -%}
    {%- if endpoint.endpoint_type == "Adapter" and endpoint.adapter_protocol == "FTP" and endpoint.message_exchange_pattern == "Accept" %}
      {% assign endpoint_name = endpoint.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: ftpReceiveAdapterEndpoint{{ app_name }}{{ endpoint_name }}
    targets:
      - target: ['consumption', 'consumptionlite']
        templates:
          - ftpReceiveAzureFtpConnectionEndpointConsumption{{ app_name }}{{ endpoint_name }}
          - ftpReceiveAzureServiceBusConnectionEndpointConsumption{{ app_name }}{{ endpoint_name }}
          - ftpReceiveAzureAdapterEndpointConsumption{{ app_name }}{{ endpoint_name }}          
          - receiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - receiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - receiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
          - deployFtpReceiveAdapterLogicAppConsumption{{ app_name }}{{ endpoint_name }}
          - deployFtpReceiveAdapterFtpApiConnectionConsumption{{ app_name }}{{ endpoint_name }}
          - deployFtpReceiveAdapterServiceBusApiConnectionConsumption{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - deployReceiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
      - target: ['standard', 'standardlite']
        templates:
          - ftpReceiveAzureFtpConnectionEndpointStandard{{ app_name }}{{ endpoint_name }}
          - ftpReceiveAzureServiceBusConnectionEndpointStandard{{ app_name }}{{ endpoint_name }}
          - ftpReceiveAzureAdapterEndpointStandard{{ app_name }}{{ endpoint_name }}
          - receiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - receiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - receiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
          - deployFtpReceiveAdapterFtpApiConnectionStandard{{ app_name }}{{ endpoint_name }}
          - deployFtpReceiveAdapterServiceBusApiConnectionStandard{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - deployReceiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
    {%- endif %}
  {%- endfor %}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for endpoint in application.endpoints -%}
    {%- if endpoint.endpoint_type == "Adapter" and endpoint.adapter_protocol == "FTP" and endpoint.message_exchange_pattern == "Send" %}
      {% assign endpoint_name = endpoint.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: ftpSendAdapterEndpoint{{ app_name }}{{ endpoint_name }}
    targets:
      - target: ['consumption', 'consumptionlite']
        templates:
          - deployFtpSendAdapterLogicAppConsumption{{ app_name }}{{ endpoint_name }}
          - deployFtpSendAdapterApiConnectionConsumption{{ app_name }}{{ endpoint_name }}
          - ftpSendAzureConnectionEndpointConsumption{{ app_name }}{{ endpoint_name }}
          - ftpSendAzureAdapterEndpointConsumption{{ app_name }}{{ endpoint_name }}
      - target: ['standard', 'standardlite']
        templates:
          - deployFtpSendAdapterApiConnectionStandard{{ app_name }}{{ endpoint_name }}
          - ftpSendAzureConnectionEndpointStandard{{ app_name }}{{ endpoint_name }}
          - ftpSendAzureAdapterEndpointStandard{{ app_name }}{{ endpoint_name }}
     {%- endif %}
  {%- endfor %}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for endpoint in application.endpoints -%}
    {%- if endpoint.endpoint_type == "Adapter" and endpoint.adapter_protocol == "SFTP" and endpoint.message_exchange_pattern == "Accept" %}
      {% assign endpoint_name = endpoint.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: sftpReceiveAdapterEndpoint{{ app_name }}{{ endpoint_name }}
    targets:
      - target: ['consumption', 'consumptionlite']
        templates:
          - sftpReceiveAzureSftpConnectionEndpointConsumption{{ app_name }}{{ endpoint_name }}
          - sftpReceiveAzureServiceBusConnectionEndpointConsumption{{ app_name }}{{ endpoint_name }}
          - sftpReceiveAzureAdapterEndpointConsumption{{ app_name }}{{ endpoint_name }}          
          - receiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - receiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - receiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
          - deploySftpReceiveAdapterLogicAppConsumption{{ app_name }}{{ endpoint_name }}
          - deploySftpReceiveAdapterSftpApiConnectionConsumption{{ app_name }}{{ endpoint_name }}
          - deploySftpReceiveAdapterServiceBusApiConnectionConsumption{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - deployReceiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
      - target: ['standard', 'standardlite']
        templates:
          - sftpReceiveAzureSftpConnectionEndpointStandard{{ app_name }}{{ endpoint_name }}
          - sftpReceiveAzureServiceBusConnectionEndpointStandard{{ app_name }}{{ endpoint_name }}
          - sftpReceiveAzureAdapterEndpointStandard{{ app_name }}{{ endpoint_name }}
          - receiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - receiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - receiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
          - deploySftpReceiveAdapterSftpApiConnectionStandard{{ app_name }}{{ endpoint_name }}
          - deploySftpReceiveAdapterServiceBusApiConnectionStandard{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - deployReceiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
    {%- endif %}
  {%- endfor %}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for endpoint in application.endpoints -%}
    {%- if endpoint.endpoint_type == "Adapter" and endpoint.adapter_protocol == "SFTP" and endpoint.message_exchange_pattern == "Send" %}
      {% assign endpoint_name = endpoint.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: sftpSendAdapterEndpoint{{ app_name }}{{ endpoint_name }}
    targets:
      - target: ['consumption', 'consumptionlite']
        templates:
          - deploySftpSendAdapterLogicAppConsumption{{ app_name }}{{ endpoint_name }}
          - deploySftpSendAdapterApiConnectionConsumption{{ app_name }}{{ endpoint_name }}
          - sftpSendAzureConnectionEndpointConsumption{{ app_name }}{{ endpoint_name }}
          - sftpSendAzureAdapterEndpointConsumption{{ app_name }}{{ endpoint_name }}
      - target: ['standard', 'standardlite']
        templates:
          - deploySftpSendAdapterApiConnectionStandard{{ app_name }}{{ endpoint_name }}
          - sftpSendAzureConnectionEndpointStandard{{ app_name }}{{ endpoint_name }}
          - sftpSendAzureAdapterEndpointStandard{{ app_name }}{{ endpoint_name }}
     {%- endif %}
  {%- endfor %}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for endpoint in application.endpoints -%}
    {%- if endpoint.endpoint_type == "Adapter" and endpoint.adapter_protocol == "FILE" and endpoint.message_exchange_pattern == "Accept" %}
      {% assign endpoint_name = endpoint.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: fileReceiveAdapterEndpoint{{ app_name }}{{ endpoint_name }}
    targets:
      - target: ['consumption', 'consumptionlite']
        templates:
          - fileReceiveAzureFileConnectionEndpointConsumption{{ app_name }}{{ endpoint_name }}
          - fileReceiveAzureServiceBusConnectionEndpointConsumption{{ app_name }}{{ endpoint_name }}
          - fileReceiveAzureAdapterEndpointConsumption{{ app_name }}{{ endpoint_name }}
          - receiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - receiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - receiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
          - deployFileReceiveAdapterLogicAppConsumption{{ app_name }}{{ endpoint_name }}
          - deployFileReceiveAdapterFileApiConnectionConsumption{{ app_name }}{{ endpoint_name }}
          - deployFileReceiveAdapterServiceBusApiConnectionConsumption{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - deployReceiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
      - target: ['standard', 'standardlite']
        templates:
          - fileReceiveAzureFileConnectionEndpointStandard{{ app_name }}{{ endpoint_name }}
          - fileReceiveAzureServiceBusConnectionEndpointStandard{{ app_name }}{{ endpoint_name }}
          - fileReceiveAzureAdapterEndpointStandard{{ app_name }}{{ endpoint_name }}
          - receiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - receiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - receiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
          - deployFileReceiveAdapterFileApiConnectionStandard{{ app_name }}{{ endpoint_name }}
          - deployFileReceiveAdapterServiceBusApiConnectionStandard{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - deployReceiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
    {%- endif %}
  {%- endfor %}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for endpoint in application.endpoints -%}
    {%- if endpoint.endpoint_type == "Adapter" and endpoint.adapter_protocol == "FILE" and endpoint.message_exchange_pattern == "Send" %}
      {% assign endpoint_name = endpoint.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: fileSendAdapterEndpoint{{ app_name }}{{ endpoint_name }}
    targets:
      - target: ['consumption', 'consumptionlite']
        templates:
          - deployFileSendAdapterLogicAppConsumption{{ app_name }}{{ endpoint_name }}
          - deployFileSendAdapterApiConnectionConsumption{{ app_name }}{{ endpoint_name }}
          - fileSendAzureConnectionEndpointConsumption{{ app_name }}{{ endpoint_name }}
          - fileSendAzureAdapterEndpointConsumption{{ app_name }}{{ endpoint_name }}
      - target: ['standard', 'standardlite']
        templates:
          - deployFileSendAdapterApiConnectionStandard{{ app_name }}{{ endpoint_name }}
          - fileSendAzureConnectionEndpointStandard{{ app_name }}{{ endpoint_name }}
          - fileSendAzureAdapterEndpointStandard{{ app_name }}{{ endpoint_name }}
     {%- endif %}
  {%- endfor %}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for endpoint in application.endpoints -%}
    {%- if endpoint.endpoint_type == "Adapter" and endpoint.adapter_protocol == "HTTP" and ( endpoint.message_exchange_pattern == "ReceiveResponse" or endpoint.message_exchange_pattern == "Receive" ) %}
      {% assign endpoint_name = endpoint.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: httpReceiveAdapterEndpoint{{ app_name }}{{ endpoint_name }}
    targets:
      - target: ['consumption', 'consumptionlite']
        templates:          
          - httpReceiveAzureAdapterEndpointConsumption{{ app_name }}{{ endpoint_name }}
          - receiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - receiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - receiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
          - deployHttpReceiveAdapterLogicAppConsumption{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - deployReceiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}

      - target: ['standard', 'standardlite']
        templates:          
          - httpReceiveAzureAdapterEndpointStandard{{ app_name }}{{ endpoint_name }}
          - receiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - receiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - receiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
          - deployHttpReceiveAdapterLogicAppStandard{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingSlipConfiguration{{ app_name }}{{ endpoint_name }}
          - deployReceiveConfigurationEntry{{ app_name }}{{ endpoint_name }}
          - deployReceiveRoutingPropertyConfiguration{{ app_name }}{{ endpoint_name }}
    {%- endif %}
  {%- endfor %}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for endpoint in application.endpoints -%}
    {%- if endpoint.endpoint_type == "Adapter" and endpoint.adapter_protocol == "WCF-SAP" and endpoint.message_exchange_pattern == "Send" %}
      {% assign endpoint_name = endpoint.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: sapSendAdapterEndpoint{{ app_name }}{{ endpoint_name }}
    targets:
      - target: ['consumption', 'consumptionlite']
        templates:
          - deploySapSendAdapterLogicAppConsumption{{ app_name }}{{ endpoint_name }}
          - deploySapSendAdapterApiConnectionConsumption{{ app_name }}{{ endpoint_name }}
          - sapSendAzureConnectionEndpointConsumption{{ app_name }}{{ endpoint_name }}
          - sapSendAzureAdapterEndpointConsumption{{ app_name }}{{ endpoint_name }}
      - target: ['standard', 'standardlite']
        templates:
          - deploySapSendAdapterApiConnectionStandard{{ app_name }}{{ endpoint_name }}
          - sapSendAzureConnectionEndpointStandard{{ app_name }}{{ endpoint_name }}
          - sapSendAzureAdapterEndpointStandard{{ app_name }}{{ endpoint_name }}
     {%- endif %}
  {%- endfor %}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for endpoint in application.endpoints -%}
    {%- if endpoint.endpoint_type == "Adapter" and endpoint.adapter_protocol == "HTTP" and endpoint.message_exchange_pattern == "Send" %}
      {% assign endpoint_name = endpoint.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: httpSendAdapterEndpoint{{ app_name }}{{ endpoint_name }}
    targets:
      - target: ['consumption', 'consumptionlite']
        templates:          
          - httpSendAzureAdapterEndpointConsumption{{ app_name }}{{ endpoint_name }}
          - deployHttpSendAdapterLogicAppConsumption{{ app_name }}{{ endpoint_name }}

      - target: ['standard', 'standardlite']
        templates:          
          - httpSendAzureAdapterEndpointStandard{{ app_name }}{{ endpoint_name }}
          - deployHttpSendAdapterLogicAppStandard{{ app_name }}{{ endpoint_name }}
    {%- endif %}
  {%- endfor %}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for channel in application.channels %}
    {%- if channel.channel_type == "PublishSubscribe" %}
      {%- assign channel_name = channel.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" -%}
      {%- for subscription in channel.subscriptions %}
        {% assign subscription_name = subscription.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: topicSubscription{{ app_name }}{{ channel_name }}{{ subscription_name }}
    targets:
      - target: ['consumption', 'consumptionlite']
        templates:
          - deployTopicSubscription{{ app_name }}{{ channel_name }}{{ subscription_name }}
          - topicSubscriptionAzureServiceBus{{ app_name }}{{ channel_name }}{{ subscription_name }}

      - target: ['standard', 'standardlite']
        templates:
          - deployTopicSubscription{{ app_name }}{{ channel_name }}{{ subscription_name }}
          - topicSubscriptionAzureServiceBus{{ app_name }}{{ channel_name }}{{ subscription_name }}
      {%- endfor -%}
    {%- endif -%}
  {%- endfor -%}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for intermediary in application.intermediaries %}
    {%- if intermediary.intermediary_type == "MessageRouter" and intermediary.message_router_type == "ProcessManager" and intermediary.activator == true %}
      {% assign intermediary_name = intermediary.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: activatableProcessManager{{ app_name }}{{ intermediary_name }}
    targets:
      - target: ['consumption', 'consumptionlite']
        templates:
          - deployProcessManagerApiConnectionConsumption{{ app_name }}{{ intermediary_name }}
          - deployProcessManagerConfigurationEntry{{ app_name }}{{ intermediary_name }}
          - deployProcessManagerLogicAppConsumption{{ app_name }}{{ intermediary_name }}
          - deployProcessManagerRoutingSlip{{ app_name }}{{ intermediary_name }}
          - activatableProcessManagerAzureApiConnectionConsumption{{ app_name }}{{ intermediary_name }}
          - activatableProcessManagerAzureConfigurationEntry{{ app_name }}{{ intermediary_name }}
          - activatableProcessManagerAzureLogicAppConsumption{{ app_name }}{{ intermediary_name }}
          - activatableProcessManagerRoutingSlip{{ app_name }}{{ intermediary_name }}
        snippets:
          - activatableWorkflowDefinitionConsumption{{ app_name }}{{ intermediary_name }}
          - activatableWorkflowParametersDefinitionConsumption{{ app_name }}{{ intermediary_name }}
          - parameterMessageBusResourceGroupConsumption{{ app_name }}{{ intermediary_name }}
          - parameterSystemApplicationResourceGroupConsumption{{ app_name }}{{ intermediary_name }}
          - parameterApimServiceConsumption{{ app_name }}{{ intermediary_name }}
          - parameterApimRetryPolicyConsumption{{ app_name }}{{ intermediary_name }}
          - parameterApimSubscriptionKeyConsumption{{ app_name }}{{ intermediary_name }}
          - parameterMessageSuspendProcessorLogicAppConsumption{{ app_name }}{{ intermediary_name }}
          - parameterSuspendQueueTopicConsumption{{ app_name }}{{ intermediary_name }}
          - parameterRoutingSlipRouterLogicAppConsumption{{ app_name }}{{ intermediary_name }}
          - parameterRoutingSlipRouterRetryPolicyConsumption{{ app_name }}{{ intermediary_name }}
          - parameterIntegrationAccountConsumption{{ app_name }}{{ intermediary_name }}
          - parameterServiceBusTopicConsumption{{ app_name }}{{ intermediary_name }}
          - parameterServiceBusTopicSubscribeApiConnectionConsumption{{ app_name }}{{ intermediary_name }}
          - parameterServiceBusTopicPublishApiConnectionConsumption{{ app_name }}{{ intermediary_name }}
          - parameterServiceBusTopicSubscriptionConsumption{{ app_name }}{{ intermediary_name }}
          - parameterServiceBusRecurrenceFrequencyConsumption{{ app_name }}{{ intermediary_name }}
          - parameterServiceBusRecurrenceIntervalConsumption{{ app_name }}{{ intermediary_name }}
          - parameterScenarioConsumption{{ app_name }}{{ intermediary_name }}
          - parameterScenarioStepConsumption{{ app_name }}{{ intermediary_name }}
          - parameterTagsConsumption{{ app_name }}{{ intermediary_name }}
          - propertyTagsConsumption{{ app_name }}{{ intermediary_name }}
          - propertyIntegrationAccountConsumption{{ app_name }}{{ intermediary_name }}
          - variableApimServiceConsumption{{ app_name }}{{ intermediary_name }}
          - variableConfigurationManagerConsumption{{ app_name }}{{ intermediary_name }}
          - variableIntegrationAccountConsumption{{ app_name }}{{ intermediary_name }}
          - variableMessagingManagerConsumption{{ app_name }}{{ intermediary_name }}
          - variableRoutingManagerConsumption{{ app_name }}{{ intermediary_name }}
          - variableRoutingSlipRouterLogicAppConsumption{{ app_name }}{{ intermediary_name }}
          - variableMessageSuspendProcessorLogicAppConsumption{{ app_name }}{{ intermediary_name }}
          - variableServiceBusSubscribeApiConnectionConsumption{{ app_name }}{{ intermediary_name }}
          - variableServiceBusPublishApiConnectionConsumption{{ app_name }}{{ intermediary_name }}
          - channelServiceBusTopicTriggerConsumption{{ app_name }}{{ intermediary_name }}
          - channelServiceBusTopicSendConsumption{{ app_name }}{{ intermediary_name }}
          - variablePlaceHolderConsumption{{ app_name }}{{ intermediary_name }}
          - variableInitializeConfigurationConsumption{{ app_name }}{{ intermediary_name }}
          - variableInitializeErrorMessageConsumption{{ app_name }}{{ intermediary_name }}
          - variableInitializeFaultMessageConsumption{{ app_name }}{{ intermediary_name }}
          - variableInitializeMessageTypeConsumption{{ app_name }}{{ intermediary_name }}
          - variableInitializeStatusCodeConsumption{{ app_name }}{{ intermediary_name }}
          - messagePlaceHolderConsumption{{ app_name }}{{ intermediary_name }}
          - activityContainerPlaceHolderConsumption{{ app_name }}{{ intermediary_name }}
          - activityContainerWorkflowConsumption{{ app_name }}{{ intermediary_name }}
          - activityContainerTaskConsumption{{ app_name }}{{ intermediary_name }}
          - activityContainerDecisionConsumption{{ app_name }}{{ intermediary_name }}
          - activityContainerDecisionBranchConsumption{{ app_name }}{{ intermediary_name }}
          - activityPlaceHolderConsumption{{ app_name }}{{ intermediary_name }}
          - activityCodeExpressionConsumption{{ app_name }}{{ intermediary_name }}
          - activityMessageTransformConsumption{{ app_name }}{{ intermediary_name }}
          - activityMessageConstructionConsumption{{ app_name }}{{ intermediary_name }}
          - activityInvokeWorkflowConsumption{{ app_name }}{{ intermediary_name }}
          - actionDecodeServiceBusMessageConsumption{{ app_name }}{{ intermediary_name }}
          - actionGetConfigurationConsumption{{ app_name }}{{ intermediary_name }}

      - target: ['standard', 'standardlite']
        templates:
          - deployProcessManagerConfigurationEntry{{ app_name }}{{ intermediary_name }}
          - deployProcessManagerRoutingSlip{{ app_name }}{{ intermediary_name }}
          - activatableProcessManagerAzureConfigurationEntry{{ app_name }}{{ intermediary_name }}
          - activatableProcessManagerRoutingSlip{{ app_name }}{{ intermediary_name }}
          - activatableProcessManagerAzureLogicAppStandard{{ app_name }}{{ intermediary_name }}
        snippets:
          - activatableWorkflowDefinitionStandard{{ app_name }}{{ intermediary_name }}
          - activatableWorkflowParametersDefinitionStandard{{ app_name }}{{ intermediary_name }}
          - activatableWorkflowLocalParametersDefinitionStandard{{ app_name }}{{ intermediary_name }}
          - activatableWorkflowAppSettingsDefinitionStandard{{ app_name }}{{ intermediary_name }}
          - activatableWorkflowLocalAppSettingsDefinitionStandard{{ app_name }}{{ intermediary_name }}
          - activatableWorkflowConnectionsDefinitionStandard{{ app_name }}{{ intermediary_name }}
          - parameterServiceBusTopicStandard{{ app_name }}{{ intermediary_name }}
          - parameterServiceBusTopicSubscriptionStandard{{ app_name }}{{ intermediary_name }}
          - parameterScenarioStandard{{ app_name }}{{ intermediary_name }}
          - parameterScenarioStepStandard{{ app_name }}{{ intermediary_name }}
          - channelServiceBusTopicTriggerStandard{{ app_name }}{{ intermediary_name }}
          - channelServiceBusTopicSendStandard{{ app_name }}{{ intermediary_name }}
          - variablePlaceHolderStandard{{ app_name }}{{ intermediary_name }}
          - variableInitializeConfigurationStandard{{ app_name }}{{ intermediary_name }}
          - variableInitializeErrorMessageStandard{{ app_name }}{{ intermediary_name }}
          - variableInitializeFaultMessageStandard{{ app_name }}{{ intermediary_name }}
          - variableInitializeMessageTypeStandard{{ app_name }}{{ intermediary_name }}
          - variableInitializeStatusCodeStandard{{ app_name }}{{ intermediary_name }}
          - messagePlaceHolderStandard{{ app_name }}{{ intermediary_name }}
          - activityContainerPlaceHolderStandard{{ app_name }}{{ intermediary_name }}
          - activityContainerWorkflowStandard{{ app_name }}{{ intermediary_name }}
          - activityContainerTaskStandard{{ app_name }}{{ intermediary_name }}
          - activityContainerDecisionStandard{{ app_name }}{{ intermediary_name }}
          - activityContainerDecisionBranchStandard{{ app_name }}{{ intermediary_name }}
          - activityPlaceHolderStandard{{ app_name }}{{ intermediary_name }}
          - activityCodeExpressionStandard{{ app_name }}{{ intermediary_name }}
          - activityMessageTransformStandard{{ app_name }}{{ intermediary_name }}
          - activityMessageConstructionStandard{{ app_name }}{{ intermediary_name }}
          - activityInvokeWorkflowStandard{{ app_name }}{{ intermediary_name }}
          - actionDecodeServiceBusMessageStandard{{ app_name }}{{ intermediary_name }}
          - actionGetConfigurationStandard{{ app_name }}{{ intermediary_name }}
    {%- endif %}
  {%- endfor %}
{%- endfor %}

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for intermediary in application.intermediaries %}
    {%- if intermediary.intermediary_type == "MessageRouter" and intermediary.message_router_type == "ProcessManager" and intermediary.activator == false %}
      {% assign intermediary_name = intermediary.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: invokableProcessManager{{ app_name }}{{ intermediary_name }}
    targets:
      - target: ['consumption', 'consumptionlite']
        templates:
          - deployProcessManagerApiConnectionConsumption{{ app_name }}{{ intermediary_name }}
          - deployProcessManagerLogicAppConsumption{{ app_name }}{{ intermediary_name }}
          - invokableProcessManagerAzureApiConnectionConsumption{{ app_name }}{{ intermediary_name }}
          - invokableProcessManagerAzureLogicAppConsumption{{ app_name }}{{ intermediary_name }}
        snippets:
          - invokableWorkflowDefinitionConsumption{{ app_name }}{{ intermediary_name }}
          - invokableWorkflowParametersDefinitionConsumption{{ app_name }}{{ intermediary_name }}
          - parameterMessageBusResourceGroupConsumption{{ app_name }}{{ intermediary_name }}
          - parameterApimServiceConsumption{{ app_name }}{{ intermediary_name }}
          - parameterApimRetryPolicyConsumption{{ app_name }}{{ intermediary_name }}
          - parameterApimSubscriptionKeyConsumption{{ app_name }}{{ intermediary_name }}
          - parameterRoutingSlipRouterLogicAppConsumption{{ app_name }}{{ intermediary_name }}
          - parameterRoutingSlipRouterRetryPolicyConsumption{{ app_name }}{{ intermediary_name }}
          - parameterIntegrationAccountConsumption{{ app_name }}{{ intermediary_name }}
          - parameterServiceBusTopicPublishApiConnectionConsumption{{ app_name }}{{ intermediary_name }}
          - parameterScenarioConsumption{{ app_name }}{{ intermediary_name }}
          - parameterScenarioStepConsumption{{ app_name }}{{ intermediary_name }}
          - parameterTagsConsumption{{ app_name }}{{ intermediary_name }}
          - propertyTagsConsumption{{ app_name }}{{ intermediary_name }}
          - propertyIntegrationAccountConsumption{{ app_name }}{{ intermediary_name }}
          - variableApimServiceConsumption{{ app_name }}{{ intermediary_name }}
          - variableConfigurationManagerConsumption{{ app_name }}{{ intermediary_name }}
          - variableIntegrationAccountConsumption{{ app_name }}{{ intermediary_name }}
          - variableMessagingManagerConsumption{{ app_name }}{{ intermediary_name }}
          - variableRoutingManagerConsumption{{ app_name }}{{ intermediary_name }}
          - variableRoutingSlipRouterLogicAppConsumption{{ app_name }}{{ intermediary_name }}
          - variableServiceBusPublishApiConnectionConsumption{{ app_name }}{{ intermediary_name }}
          - channelHttpTriggerConsumption{{ app_name }}{{ intermediary_name }}
          - channelServiceBusTopicSendConsumption{{ app_name }}{{ intermediary_name }}
          - variablePlaceHolderConsumption{{ app_name }}{{ intermediary_name }}
          - variableInitializeConfigurationConsumption{{ app_name }}{{ intermediary_name }}
          - variableInitializeErrorMessageConsumption{{ app_name }}{{ intermediary_name }}
          - variableInitializeFaultMessageConsumption{{ app_name }}{{ intermediary_name }}
          - variableInitializeMessageTypeConsumption{{ app_name }}{{ intermediary_name }}
          - variableInitializeStatusCodeConsumption{{ app_name }}{{ intermediary_name }}
          - messagePlaceHolderConsumption{{ app_name }}{{ intermediary_name }}
          - activityContainerPlaceHolderConsumption{{ app_name }}{{ intermediary_name }}
          - activityContainerTaskConsumption{{ app_name }}{{ intermediary_name }}
          - activityContainerDecisionConsumption{{ app_name }}{{ intermediary_name }}
          - activityContainerDecisionBranchConsumption{{ app_name }}{{ intermediary_name }}
          - activityPlaceHolderConsumption{{ app_name }}{{ intermediary_name }}
          - activityCodeExpressionConsumption{{ app_name }}{{ intermediary_name }}
          - activityMessageTransformConsumption{{ app_name }}{{ intermediary_name }}
          - activityMessageConstructionConsumption{{ app_name }}{{ intermediary_name }}
          - activityInvokeWorkflowConsumption{{ app_name }}{{ intermediary_name }}
          - actionGetConfigurationConsumption{{ app_name }}{{ intermediary_name }}

      - target: ['standard', 'standardlite']
        templates:
          - invokableProcessManagerAzureLogicAppStandard{{ app_name }}{{ intermediary_name }}
        snippets:
          - invokableWorkflowDefinitionStandard{{ app_name }}{{ intermediary_name }}
          - invokableWorkflowParametersDefinitionStandard{{ app_name }}{{ intermediary_name }}
          - invokableWorkflowLocalParametersDefinitionStandard{{ app_name }}{{ intermediary_name }}
          - invokableWorkflowAppSettingsDefinitionStandard{{ app_name }}{{ intermediary_name }}
          - invokableWorkflowLocalAppSettingsDefinitionStandard{{ app_name }}{{ intermediary_name }}
          - invokableWorkflowConnectionsDefinitionStandard{{ app_name }}{{ intermediary_name }}
          - channelHttpTriggerStandard{{ app_name }}{{ intermediary_name }}
          - channelServiceBusTopicSendStandard{{ app_name }}{{ intermediary_name }}
    {%- endif %}
  {%- endfor %}
{%- endfor %}

  # ------------------------------------------------------------------------------
  # BizTalk specific resources
  # ------------------------------------------------------------------------------

  - resource: topicChannel
    targets:
      - target: ['consumption', 'standard']
        templates:
          - topicChannelAzureServiceBusStandard
          - namespaceAzureServiceBusStandard
          - deployNamespace
          - deployTopicChannel

  - resource: topicResponseChannel
    targets:
      - target: ['consumption', 'standard']
        templates:
          - topicResponseChannelAzureServiceBusStandard
          - deployTopicResponseChannel

  - resource: suspendQueueChannel
    targets:
      - target: ['consumption', 'standard']
        templates:
          - suspendQueueChannelAzureServiceBusTopic
          - deploySuspendQueueChannel

  - resource: contentDemoter
    targets:
      - target: ['consumption']
        templates:
          - contentDemoterAzureLogicAppConsumption
          - deployContentDemoterConsumption
      - target: ['consumptionlite']
        templates:
          - contentDemoterAzureLogicAppConsumption
      - target: ['standard', 'standardlite']
        templates:
          - contentDemoterAzureLogicAppStandard

  - resource: contentPromoter
    targets:
      - target: ['consumption']
        templates:
          - contentPromoterAzureLogicAppConsumption
          - deployContentPromoterConsumption
      - target: ['consumptionlite']
        templates:
          - contentPromoterAzureLogicAppConsumption
      - target: ['standard', 'standardlite']
        templates:
          - contentPromoterAzureLogicAppStandard

  - resource: topicPublisherApiConnection
    targets:
      - target: ['consumption']
        templates:
          - topicPublisherAzureApiConnectionConsumption
          - deployTopicPublisherApiConnectionConsumption

  - resource: topicPublisher
    targets:
      - target: ['consumption']
        templates:
          - topicPublisherAzureLogicAppConsumption
          - deployTopicPublisherConsumption
      - target: ['consumptionlite']
        templates:
          - topicPublisherAzureLogicAppConsumption
      - target: ['standard', 'standardlite']
        templates:
          - topicPublisherAzureLogicAppStandard

{%- for application in model.migration_target.message_bus.applications %}
  {%- assign app_name = application.name | remove: " " | replace: ".", "-" | replace: ":", "-" -%}
  {%- for intermediary in application.intermediaries %}
    {%- if intermediary.intermediary_type == "MessageRouter" and intermediary.message_router_type == "MessageSubscriber" %}
      {% assign intermediary_name = intermediary.name | remove: " " | replace: ".", "-" | replace: "/", "-" | replace: ":", "-" %}
  - resource: topicSubscriber{{ app_name }}{{ intermediary_name }}
    targets:
      - target: ['consumption', 'consumptionlite']
        templates:
          - topicSubscriberAzureApiConnectionConsumption{{ app_name }}{{ intermediary_name }}
          - topicSubscriberAzureLogicAppConsumption{{ app_name }}{{ intermediary_name }}
          - sendRoutingSlipConfiguration{{ app_name }}{{ intermediary_name }}
          - sendConfigurationEntry{{ app_name }}{{ intermediary_name }}
          - sendRoutingPropertyConfiguration{{ app_name }}{{ intermediary_name }}
          - deployTopicSubscriberApiConnectionConsumption{{ app_name }}{{ intermediary_name }}
          - deployTopicSubscriberLogicAppConsumption{{ app_name }}{{ intermediary_name }}
          - deploySendRoutingSlipConfiguration{{ app_name }}{{ intermediary_name }}
          - deploySendConfigurationEntry{{ app_name }}{{ intermediary_name }}
          - deploySendRoutingPropertyConfiguration{{ app_name }}{{ intermediary_name }}
      - target: ['standard', 'standardlite']
        templates:
          - topicSubscriberAzureLogicAppStandard{{ app_name }}{{ intermediary_name }}
          - sendRoutingSlipConfiguration{{ app_name }}{{ intermediary_name }}
          - sendConfigurationEntry{{ app_name }}{{ intermediary_name }}
          - sendRoutingPropertyConfiguration{{ app_name }}{{ intermediary_name }}
          - deploySendRoutingSlipConfiguration{{ app_name }}{{ intermediary_name }}
          - deploySendConfigurationEntry{{ app_name }}{{ intermediary_name }}
          - deploySendRoutingPropertyConfiguration{{ app_name }}{{ intermediary_name }}
    {%- endif %}
  {%- endfor %}
{%- endfor %}

{%- if deploy_data_gateway == true %}
  - resource: dataGateway
    targets:
      - target: ['consumption', 'standard', 'consumptionlite', 'standardlite']
        templates:
          - onPremiseDataGateway
          - deployOnPremiseDataGateway
{%- endif %}